# AWS Lambda

- 강의 : youtube `동빈나 - AWS Lambda 강좌`
    - https://www.youtube.com/watch?v=7uEDep9DFJs&list=PLRx0vPvlEmdD_AdG6fEwcfVrq5Qb3q_Ja


- 특정 프로그램을 우리의 컴퓨터 위에서 구동시키고 있지 않더라도 
    > AWS Lambda 웹사이트에서 코드를 몇 줄 입력하는 것만으로도 
        AWS 위에서 알아서 AWS 위에서 자동으로 프로그램이 동작한다.
    > 별도의 서버나 컴퓨터 자체를 구비해두고, 항상 동작하게 할 필요가 없다.
    > 웹사이트상에서 코드만 몇 줄 넣게 되면 , AWS에서 자동으로 코드를 동작시켜 준다.

- AWS Lambda를 하나의 함수로 보기만 하면 된다.
- 하나의 함수를 작성해서 자동으로 실행시키기만 하면 된다고 한다.
- 작성할 함수를 언제 작동시킬 지 또한 우리가 정할 수 있다.
    - 특정 이벤트가 발생했을 때 실행시킬 수도 있다.
        ( 이벤트가 발생하는 경우는 다양하다. )

    - 혹은 AWS Lambda를 별도의 웹 서버처럼 운용할 수 있다.
        > 클라이언트 요청을 이벤트로 해서 , AWS Lambda를 이벤트 처리 함수로 설정하여 함수 실행값 반환 가능
    
- 기존에는 웹 서버 프로그램을 만들고, 그 페이지가 apache 등과 같은 웹 서버에서 구동되는 것이 일반적이라면 , 
    - Lambda를 이용했을 때는 , 소스 코드와 몇 가지 설정으로 가능하다.


## 상황 가정 : 클라이언트가 서버에 요청을 하고, 이를 Lambda로 처리하자.

- 구성도 : 플레이어( 클라이언트 ) -> API 게이트웨이 -> AWS 람다 -> DB

Lambda는 API GateWay라는 것을 지원하는데, 이를 별도의 웹 서버처럼 기능을 하게 한다.

1. 클라이언트가 우리의 서버에 접속한다.
2. 먼저 API 게이트웨이를 거친다.
3. 이후에 AWS 람다가 실제로 클라이언트의 요청( Request )을 처리하고, 
4. 그 결과를 반환한다. ( 혹은 실행 결과를 차후에 사용하기 위해 DB에 담는다. )

- AWS 람다 자체는 요청을 처리하는 함수로서의 역할을 수행하기 때문에,
- 이를 실제 서버처럼 동작하기 위해서는 API 게이트웨이를 이용해 공인 주소를 설정해야 한다.

### 실습

- 먼저 aws 웹페이지에 접속하자.
    - https://aws.amazon.com/ko/

- 메인 페이지에 들어오면 `콘솔에 로그인` 을 해준다.
    - https://sujinisacat.tistory.com/12
    - VISA 지원되는 카드를 등록해야 한다 + 모든 정보를 영문으로 입력해야 한다. ( 많이 번거롭다. )

- 계정 생성을 하여 로그인에 들어온 후 , aws 메인 페이지에서 lambda 검색하여 AWS Lambda 서비스로 들어온다.
    - 들어오면 , 아무 함수도 실행되지 않은 모습을 보여준다.
    image.png

- `create function 버튼`을 누르면 , 함수명과 런타임 시 사용할 언어를 고를 수 있게 되는데, 대부분 Node.js 혹은 Python을 사용한다.
    - Hello_Lambda_Python 이라는 함수를 생성하고 , Python 3.7 버전을 사용하였다.
    - 권한은 다른 것 건드리지 않고 일반 권한으로 사용하였다.
    - 창의 맨 밑에 `Create Function` 버튼을 누르면 , 지정한 이름 , Python 언어의 함수를 생성한다.

- Lambda 함수는 사용한 만큼만 비용을 부담하지만 , 사용량이 적을 경우 거의 무료로 이용할 수 있다고 한다.

- 함수로 들어오면 , `트리거`와 `대상` 항목이 있다.
    - **트리거** : 람다 함수는 특정 조건( 트리거 )가 발생하였을 때 실행되는데 , 해당 조건을 트리거라고 한다.
    - 처리된 내용은 로그로 남게 된다.
    - **대상** : 

- 창을 내려서 코드 섹션을 보면 , lambda_function 창이 있고, 에디터처럼 함수를 작성할 수 있는 칸이 있다.
- 여러 파이썬 혹은 다른 언어의 코드 파일을 생성할 수 있고, 실행할 수 있다.
    - **핸들러** : 전체 코드 중 맨 처음에 실행할 파이썬 코드 파일에 해당

#### lambda_function.py( 핸들러 함수 )

- 파라미터 : event , context 
    - event : 트리거에 해당( 해당 lambda 함수가 발생하도록 만든 트리거 이벤트에 해당 )

#### 실행

- 실제로 트리거를 설정해서 사용자가 접속했을 때 람다 함수가 작동되도록 해 보자.
- 위에서 보았듯이 웹 서버로 작동하려면 `API Gateway`가 필요하다고 했었다.